<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BrainQuest - Educational Learning Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #a6ab10 0%, #9f2828 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            width: 100%;
            background: rgb(237, 241, 238);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(255, 77, 0, 0.981);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #3c57c1 0%, #1dbd0e 100%);
            color: rgb(247, 241, 241);
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        /* Age Selection Screen */
        .age-selection {
            text-align: center;
        }

        .age-selection h2 {
            color: #160202;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .age-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .age-btn {
            background: linear-gradient(135deg, #0ea813 0%, #1512bd 100%);
            color: white;
            border: none;
            padding: 30px 20px;
            border-radius: 15px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .age-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .age-btn .emoji {
            font-size: 2em;
            display: block;
            margin-bottom: 10px;
        }

        /* Progress Bar */
        .progress-section {
            background: #ffffff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .progress-bar {
            background: #ecf2f5;
            height: 25px;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #d24807 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgb(255, 255, 255);
            font-weight: bold;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-card {
            text-align: center;
            padding: 15px;
            background: rgb(16, 0, 0);
            border-radius: 10px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #f9f9fa;
        }

        .stat-label {
            color: #ffffff;
            font-size: 0.9em;
            margin-top: 5px;
        }

        /* Level Navigation */
        .level-nav {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }

        .level-btn {
            background: #fdf7f7;
            border: 2px solid #0c26d3;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .level-btn:hover:not(:disabled) {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .level-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .level-btn.completed {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .level-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Question Section */
        .question-section {
            background: #0f7ae6;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-number {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
        }

        .voice-controls {
            display: flex;
            gap: 10px;
        }

        .voice-btn {
            background: #764ba2;
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s ease;
        }

        .voice-btn:hover {
            transform: scale(1.1);
            background: #470a70;
        }

        .question-text {
            font-size: 1.4em;
            color: #fffbfb;
            margin: 25px 0;
            line-height: 1.6;
        }

        .question-type-badge {
            display: inline-block;
            background: #ffc107;
            color: #333;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        /* Answer Options */
        .options-grid {
            display: grid;
            gap: 15px;
        }

        .option-btn {
            background: rgb(255, 253, 253);
            border: 3px solid #1161a7;
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1em;
            text-align: left;
            transition: all 0.3s ease;
        }

        .option-btn:hover:not(:disabled) {
            border-color: #667eea;
            transform: translateX(10px);
        }

        .option-btn.selected {
            border-color: #000000;
            background: #fffb04;
        }

        .option-btn.correct {
            border-color: #4CAF50;
            background: #e8f5e9;
        }

        .option-btn.incorrect {
            border-color: #f44336;
            background: #ffebee;
        }

        .option-btn:disabled {
            cursor: not-allowed;
        }

        /* Input Fields */
        .text-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            border: 3px solid #ddd;
            border-radius: 10px;
            margin: 15px 0;
            transition: border-color 0.3s ease;
        }

        .text-input:focus {
            outline: none;
            border-color: #667eea;
        }

        /* Puzzle Grid */
        .puzzle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .puzzle-tile {
            aspect-ratio: 1;
            background: white;
            border: 3px solid #ddd;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .puzzle-tile:hover {
            background: #f0f4ff;
            border-color: #667eea;
            transform: scale(1.05);
        }

        .puzzle-tile.selected {
            background: #667eea;
            color: white;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            justify-content: center;
        }

        .btn {
            padding: 15px 35px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Feedback */
        .feedback {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }

        .feedback.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .feedback.correct {
            background: #e8f5e9;
            border-left: 5px solid #4CAF50;
            color: #2e7d32;
        }

        .feedback.incorrect {
            background: #ffebee;
            border-left: 5px solid #f44336;
            color: #c62828;
        }

        .feedback-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .feedback-text {
            font-size: 1.1em;
            line-height: 1.6;
        }

        /* Badges */
        .badges-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .badge {
            background: #f0f0f0;
            padding: 15px 25px;
            border-radius: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            color: #999;
            transition: all 0.3s ease;
        }

        .badge.earned {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: white;
            animation: bounce 0.5s ease;
        }

        .badge-icon {
            font-size: 1.5em;
        }

        /* Final Assessment */
        .final-assessment {
            text-align: center;
        }

        .score-display {
            font-size: 5em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 30px 0;
        }

        .performance-message {
            font-size: 1.5em;
            color: #333;
            margin: 20px 0;
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .question-text {
                font-size: 1.2em;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ¯ Brain-Quest</h1>
            <p><strong>Learn English Through Fun Challenges!</strong></p>
        </div>

        <div class="content">
            <!-- Age Selection Screen -->
            <div id="ageSelectionScreen" class="age-selection">
                <h2>Welcome! Select Your Age Group</h2>
                <div class="age-buttons">
                    <button class="age-btn" onclick="selectAge('6-12')">
                        <span class="emoji">ðŸ‘¶</span>
                        6-12 Years
                    </button>
                    <button class="age-btn" onclick="selectAge('13-20')">
                        <span class="emoji">ðŸ§’</span>
                        13-20 Years
                    </button>
                    <button class="age-btn" onclick="selectAge('21-40')">
                        <span class="emoji">ðŸ‘¨</span>
                        21-40 Years
                    </button>
                    <button class="age-btn" onclick="selectAge('41-60')">
                        <span class="emoji">ðŸ‘´</span>
                        41-60 Years
                    </button>
                </div>
            </div>

            <!-- Main Game Screen -->
            <div id="gameScreen" class="hidden">
                <!-- Progress Section -->
                <div class="progress-section">
                    <h3>Your Progress</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%">0%</div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="currentLevel">1</div>
                            <div class="stat-label">Current Level</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalPoints">0</div>
                            <div class="stat-label">Points</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="correctAnswers">0</div>
                            <div class="stat-label">Correct</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="questionsAnswered">0</div>
                            <div class="stat-label">Questions</div>
                        </div>
                    </div>
                </div>

                <!-- Badges -->
                <div class="badges-container" id="badgesContainer"></div>

                <!-- Level Navigation -->
                <div class="level-nav" id="levelNav"></div>

                <!-- Question Section -->
                <div id="questionContainer" class="question-section">
                    <div class="question-header">
                        <div class="question-number" id="questionNumber">Question 1/10</div>
                        <div class="voice-controls">
                            <button class="voice-btn" onclick="speakQuestion()" title="Read Question">ðŸ”Š</button>
                            <button class="voice-btn" onclick="getHint()" title="Get Hint">ðŸ’¡</button>
                        </div>
                    </div>

                    <div class="question-type-badge" id="questionType">Vocabulary</div>
                    <div class="question-text" id="questionText"></div>

                    <div id="answerArea"></div>

                    <div class="feedback" id="feedback">
                        <div class="feedback-title" id="feedbackTitle"></div>
                        <div class="feedback-text" id="feedbackText"></div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-primary" id="submitBtn" onclick="submitAnswer()">Submit Answer</button>
                        <button class="btn btn-secondary" onclick="nextQuestion()">Next Question</button>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons" style="margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="restartGame()">ðŸ”„ Restart Game</button>
                </div>
            </div>

            <!-- Final Assessment Screen -->
            <div id="finalScreen" class="hidden final-assessment">
                <h2>ðŸŽ‰ Congratulations!</h2>
                <p>You've completed all 10 levels!</p>
                <div class="score-display" id="finalScoreDisplay">0</div>
                <div class="performance-message" id="performanceMessage"></div>

                <h3 style="margin-top: 40px;">Final Assessment</h3>
                <p>Answer 10 questions to test your knowledge</p>

                <div id="finalQuestionsContainer"></div>

                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="submitFinalTest()">Submit Test</button>
                    <button class="btn btn-secondary" onclick="restartGame()">Play Again</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State Management
        const gameState = {
            ageGroup: null,
            currentLevel: 1,
            currentQuestion: 0,
            totalPoints: 0,
            correctAnswers: 0,
            questionsAnswered: 0,
            completedLevels: [],
            levelScores: {},
            earnedBadges: [],
            currentQuestionSet: [],
            userAnswer: null,
            levelQuestionPool: {} // Track which questions are used per level
        };

        // ENHANCED: Level-specific questions that increase in difficulty
        const questionBank = {
            '6-12': {
                level1: [
                    { q: "What does 'happy' mean?", options: ["Sad", "Joyful", "Angry", "Tired"], answer: 1, explanation: "Happy means feeling or showing pleasure and joy." },
                    { q: "Which word means 'very big'?", options: ["Tiny", "Small", "Large", "Little"], answer: 2, explanation: "Large means very big in size." },
                    { q: "Complete: 'I ___ to school'", options: ["go", "goes", "going", "gone"], answer: 0, explanation: "Use 'go' with 'I' in present tense." },
                    { q: "What comes next? A, B, C, ___", type: "pattern", answer: "D", explanation: "This is the alphabetical sequence." },
                    { q: "What letter comes after M?", answer: "N", explanation: "N comes after M in the alphabet." },
                    { q: "What does 'kind' mean?", options: ["Mean", "Nice", "Rude", "Selfish"], answer: 1, explanation: "Kind means being nice and helpful to others." },
                    { q: "Fill in: 'The dog ___ barking'", options: ["is", "are", "am", "be"], answer: 0, explanation: "Use 'is' with singular subjects like 'dog'." },
                    { q: "If CAT = 3 letters, how many letters in DOG?", type: "logic", answer: "3", explanation: "DOG also has 3 letters: D-O-G." },
                    { q: "Which sentence is correct?", options: ["She play ball", "She plays ball", "She playing ball", "She played ball"], answer: 1, explanation: "Use 'plays' with 'she' in present tense." },
                    { q: "How many vowels in 'APPLE'?", answer: "2", explanation: "A and E are the two vowels in APPLE." }
                ],
                level2: [
                    { q: "What is a synonym for 'quick'?", options: ["Slow", "Fast", "Lazy", "Heavy"], answer: 1, explanation: "Fast is a synonym for quick, both mean moving rapidly." },
                    { q: "Which word means 'to jump'?", options: ["Sit", "Leap", "Sleep", "Walk"], answer: 1, explanation: "Leap means to jump or spring quickly." },
                    { q: "Complete: 'They ___ happy'", options: ["is", "am", "are", "be"], answer: 2, explanation: "Use 'are' with plural pronouns like 'they'." },
                    { q: "What word means the opposite of 'hot'?", options: ["Warm", "Cold", "Cool", "Sunny"], answer: 1, explanation: "Cold is the opposite of hot." },
                    { q: "Arrange the words: 'cat / the / sits'", type: "arrange", words: ["the", "cat", "sits"], answer: "the cat sits", explanation: "The correct order is: article + noun + verb." },
                    { q: "What does 'brave' mean?", options: ["Scared", "Fearless", "Weak", "Tired"], answer: 1, explanation: "Brave means not afraid, fearless." },
                    { q: "How many letters in 'SCHOOL'?", answer: "6", explanation: "S-C-H-O-O-L has 6 letters." },
                    { q: "Which is correct: 'He ___ reading'", options: ["is", "are", "am", "be"], answer: 0, explanation: "Use 'is' with singular subjects." },
                    { q: "What comes after Thursday?", answer: "Friday", explanation: "Friday comes after Thursday in the week." },
                    { q: "What does 'sad' mean?", options: ["Happy", "Unhappy", "Excited", "Angry"], answer: 1, explanation: "Sad means unhappy or sorrowful." }
                ],
                level3: [
                    { q: "What is an antonym for 'tall'?", options: ["High", "Short", "Long", "Big"], answer: 1, explanation: "Short is the opposite of tall." },
                    { q: "Complete: 'We ___ going to the park'", options: ["is", "am", "are", "be"], answer: 2, explanation: "Use 'are' with 'we'." },
                    { q: "What word means 'very small'?", options: ["Huge", "Tiny", "Large", "Big"], answer: 1, explanation: "Tiny means very small." },
                    { q: "If 1, 2, 3, what comes next?", answer: "4", explanation: "This is counting in sequence." },
                    { q: "What does 'angry' mean?", options: ["Happy", "Mad", "Calm", "Sleepy"], answer: 1, explanation: "Angry means mad or upset." },
                    { q: "Which is correct: 'She ___ a book'", options: ["read", "reads", "reading", "readed"], answer: 1, explanation: "Use 'reads' with 'she' in present tense." },
                    { q: "What letter comes before K?", answer: "J", explanation: "J comes before K in the alphabet." },
                    { q: "Complete: 'I ___ hungry'", options: ["is", "am", "are", "be"], answer: 1, explanation: "Use 'am' with 'I'." },
                    { q: "How many days in a week?", answer: "7", explanation: "There are 7 days in a week." },
                    { q: "What does 'new' mean?", options: ["Old", "Fresh", "Broken", "Dirty"], answer: 1, explanation: "New means fresh or not old." }
                ],
                level4: [
                    { q: "What does 'excited' mean?", options: ["Bored", "Enthusiastic", "Sad", "Angry"], answer: 1, explanation: "Excited means enthusiastic and eager." },
                    { q: "Arrange: 'runs / fast / the / dog'", type: "arrange", words: ["the", "dog", "runs", "fast"], answer: "the dog runs fast", explanation: "Correct order: article + noun + verb + adverb." },
                    { q: "What is a synonym for 'smart'?", options: ["Dumb", "Clever", "Slow", "Lazy"], answer: 1, explanation: "Clever is a synonym for smart." },
                    { q: "Complete: 'Birds ___ fly'", options: ["is", "am", "are", "can"], answer: 3, explanation: "Use 'can' to show ability." },
                    { q: "What comes next: 2, 4, 6, ___", answer: "8", explanation: "Even numbers: adding 2 each time." },
                    { q: "What does 'quiet' mean?", options: ["Loud", "Silent", "Noisy", "Busy"], answer: 1, explanation: "Quiet means silent or not loud." },
                    { q: "Which is correct: 'They ___ playing'", options: ["is", "am", "are", "be"], answer: 2, explanation: "Use 'are' with plural subjects." },
                    { q: "What is the opposite of 'day'?", answer: "night", explanation: "Night is the opposite of day." },
                    { q: "How many months in a year?", answer: "12", explanation: "There are 12 months in a year." },
                    { q: "What does 'friendly' mean?", options: ["Mean", "Kind", "Rude", "Angry"], answer: 1, explanation: "Friendly means kind and pleasant." }
                ],
                level5: [
                    { q: "What is a synonym for 'beautiful'?", options: ["Ugly", "Pretty", "Bad", "Dirty"], answer: 1, explanation: "Pretty is a synonym for beautiful." },
                    { q: "Complete: 'She ___ not like ice cream'", options: ["do", "does", "did", "done"], answer: 1, explanation: "Use 'does' with 'she' in negative present tense." },
                    { q: "What does 'difficult' mean?", options: ["Easy", "Hard", "Simple", "Quick"], answer: 1, explanation: "Difficult means hard or not easy." },
                    { q: "Arrange: 'book / reads / a / she'", type: "arrange", words: ["she", "reads", "a", "book"], answer: "she reads a book", explanation: "Correct sentence structure." },
                    { q: "If 5, 10, 15, what's next?", answer: "20", explanation: "Counting by fives." },
                    { q: "What is the opposite of 'clean'?", options: ["Dirty", "Neat", "Tidy", "Pure"], answer: 0, explanation: "Dirty is the opposite of clean." },
                    { q: "Complete: 'We ___ to school yesterday'", options: ["go", "goes", "went", "going"], answer: 2, explanation: "Use 'went' for past tense." },
                    { q: "What does 'careful' mean?", options: ["Careless", "Cautious", "Reckless", "Fast"], answer: 1, explanation: "Careful means cautious and paying attention." },
                    { q: "How many colors in a rainbow?", answer: "7", explanation: "There are 7 colors in a rainbow." },
                    { q: "What word means 'very cold'?", options: ["Hot", "Warm", "Freezing", "Cool"], answer: 2, explanation: "Freezing means very cold." }
                ],
                level6: [
                    { q: "What does 'curious' mean?", options: ["Uninterested", "Inquisitive", "Bored", "Lazy"], answer: 1, explanation: "Curious means inquisitive and eager to learn." },
                    { q: "Complete: 'If it ___ tomorrow, we will stay home'", options: ["rain", "rains", "rained", "raining"], answer: 1, explanation: "Use present tense in conditional sentences." },
                    { q: "What is an antonym for 'weak'?", options: ["Strong", "Fragile", "Soft", "Tiny"], answer: 0, explanation: "Strong is the opposite of weak." },
                    { q: "Arrange: 'always / he / homework / his / does'", type: "arrange", words: ["he", "always", "does", "his", "homework"], answer: "he always does his homework", explanation: "Adverbs usually go before main verbs." },
                    { q: "What pattern: Red, Blue, Red, Blue, ___", answer: "Red", explanation: "Alternating color pattern." },
                    { q: "What does 'honest' mean?", options: ["Lying", "Truthful", "Fake", "Tricky"], answer: 1, explanation: "Honest means truthful and not lying." },
                    { q: "Complete: 'She has ___ to Paris'", options: ["go", "went", "gone", "going"], answer: 2, explanation: "Use 'gone' with 'has' in present perfect." },
                    { q: "What word means 'full of joy'?", options: ["Sad", "Joyful", "Angry", "Tired"], answer: 1, explanation: "Joyful means full of joy and happiness." },
                    { q: "How many sides does a triangle have?", answer: "3", explanation: "A triangle has 3 sides." },
                    { q: "What does 'polite' mean?", options: ["Rude", "Respectful", "Mean", "Loud"], answer: 1, explanation: "Polite means respectful and well-mannered." }
                ],
                level7: [
                    { q: "What does 'generous' mean?", options: ["Selfish", "Giving", "Mean", "Greedy"], answer: 1, explanation: "Generous means giving and unselfish." },
                    { q: "Complete: 'Neither of the students ___ ready'", options: ["is", "are", "am", "be"], answer: 0, explanation: "'Neither' is singular, so use 'is'." },
                    { q: "What is a synonym for 'enormous'?", options: ["Tiny", "Huge", "Small", "Little"], answer: 1, explanation: "Huge is a synonym for enormous." },
                    { q: "Arrange: 'quickly / runs / dog / the / very'", type: "arrange", words: ["the", "dog", "runs", "very", "quickly"], answer: "the dog runs very quickly", explanation: "Adverbs at the end of the sentence." },
                    { q: "What comes next: 1, 4, 9, 16, ___", answer: "25", explanation: "Perfect squares: 1Â², 2Â², 3Â², 4Â², 5Â²." },
                    { q: "What does 'patient' mean?", options: ["Impatient", "Calm and waiting", "Rushed", "Angry"], answer: 1, explanation: "Patient means calm and able to wait." },
                    { q: "Which is correct: 'He has ___ his homework'", options: ["finish", "finished", "finishing", "finishes"], answer: 1, explanation: "Use past participle with 'has'." },
                    { q: "What is the opposite of 'success'?", answer: "failure", explanation: "Failure is the opposite of success." },
                    { q: "What does 'responsible' mean?", options: ["Irresponsible", "Reliable", "Careless", "Lazy"], answer: 1, explanation: "Responsible means reliable and accountable." },
                    { q: "How many vowels are in 'EDUCATION'?", answer: "5", explanation: "E, U, A, I, O are the 5 vowels in EDUCATION." }
                ],
                level8: [
                    { q: "What does 'determined' mean?", options: ["Giving up", "Persistent", "Lazy", "Weak"], answer: 1, explanation: "Determined means persistent and resolved." },
                    { q: "Complete: 'By the time we arrive, the movie ___ started'", options: ["will have", "will", "has", "had"], answer: 0, explanation: "Use future perfect for actions completed before a future time." },
                    { q: "What is an antonym for 'ancient'?", options: ["Old", "Modern", "Historic", "Past"], answer: 1, explanation: "Modern is the opposite of ancient." },
                    { q: "What word means 'working together'?", options: ["Fighting", "Cooperating", "Arguing", "Competing"], answer: 1, explanation: "Cooperating means working together." },
                    { q: "Pattern: 1, 1, 2, 3, 5, 8, ___", answer: "13", explanation: "Fibonacci sequence: each number is the sum of the previous two." },
                    { q: "What does 'creative' mean?", options: ["Boring", "Imaginative", "Dull", "Plain"], answer: 1, explanation: "Creative means imaginative and original." },
                    { q: "Complete: 'I wish I ___ taller'", options: ["am", "was", "were", "be"], answer: 2, explanation: "Use 'were' in hypothetical wishes." },
                    { q: "What does 'admire' mean?", options: ["Dislike", "Respect", "Hate", "Ignore"], answer: 1, explanation: "Admire means to respect and look up to." },
                    { q: "What is a synonym for 'accomplish'?", options: ["Fail", "Achieve", "Quit", "Stop"], answer: 1, explanation: "Achieve is a synonym for accomplish." },
                    { q: "How many continents on Earth?", answer: "7", explanation: "There are 7 continents on Earth." }
                ],
                level9: [
                    { q: "What does 'ambitious' mean?", options: ["Lazy", "Goal-oriented", "Careless", "Unmotivated"], answer: 1, explanation: "Ambitious means having strong desire to succeed." },
                    { q: "Complete: 'Had I known earlier, I ___ helped you'", options: ["will", "would", "would have", "will have"], answer: 2, explanation: "Use 'would have' in past conditional." },
                    { q: "What is a synonym for 'magnificent'?", options: ["Ugly", "Splendid", "Plain", "Simple"], answer: 1, explanation: "Splendid is a synonym for magnificent." },
                    { q: "What does 'compassionate' mean?", options: ["Cruel", "Sympathetic", "Mean", "Harsh"], answer: 1, explanation: "Compassionate means sympathetic and caring." },
                    { q: "Logic: If all cats meow and Fluffy is a cat, what does Fluffy do?", answer: "meow", explanation: "Logical deduction." },
                    { q: "What is the opposite of 'confident'?", options: ["Sure", "Doubtful", "Certain", "Bold"], answer: 1, explanation: "Doubtful is the opposite of confident." },
                    { q: "Complete: 'The book ___ by many people'", options: ["read", "reads", "is read", "reading"], answer: 2, explanation: "Use passive voice 'is read'." },
                    { q: "What does 'diligent' mean?", options: ["Lazy", "Hardworking", "Careless", "Slow"], answer: 1, explanation: "Diligent means hardworking and careful." },
                    { q: "What word means 'showing respect'?", options: ["Rude", "Courteous", "Mean", "Harsh"], answer: 1, explanation: "Courteous means showing respect and politeness." },
                    { q: "Analogy: Book : Read :: Pencil : ___", answer: "write", explanation: "Tools and their functions." }
                ],
                level10: [
                    { q: "What does 'perseverance' mean?", options: ["Giving up", "Persistence", "Quitting", "Laziness"], answer: 1, explanation: "Perseverance means continued effort despite difficulties." },
                    { q: "Complete: 'Not only did she sing, ___ she also danced'", options: ["and", "but", "or", "so"], answer: 1, explanation: "Use 'but' with 'not only...but also' structure." },
                    { q: "What is a sophisticated synonym for 'happy'?", options: ["Sad", "Jubilant", "Angry", "Tired"], answer: 1, explanation: "Jubilant means feeling or expressing great joy." },
                    { q: "What does 'integrity' mean?", options: ["Dishonesty", "Honesty", "Lying", "Cheating"], answer: 1, explanation: "Integrity means honesty and strong moral principles." },
                    { q: "Logic: If A>B and B>C, what is A compared to C?", answer: "greater", explanation: "Transitive property: A is greater than C." },
                    { q: "What does 'eloquent' mean?", options: ["Silent", "Articulate", "Quiet", "Mumbling"], answer: 1, explanation: "Eloquent means fluent and persuasive in speaking." },
                    { q: "What is the opposite of 'abundant'?", options: ["Plenty", "Scarce", "Much", "Lots"], answer: 1, explanation: "Scarce means in short supply, opposite of abundant." },
                    { q: "Complete: 'Scarcely ___ we arrived when it started raining'", options: ["did", "had", "have", "do"], answer: 1, explanation: "Use 'had' with 'scarcely' for past perfect." },
                    { q: "What does 'conscientious' mean?", options: ["Careless", "Thorough", "Lazy", "Sloppy"], answer: 1, explanation: "Conscientious means thorough and careful." },
                    { q: "Analogy: Doctor : Hospital :: Pilot : ___", answer: "airplane", explanation: "Professionals and their work environments." }
                ]
            },
            // Similar structure for other age groups with progressive difficulty
            '13-20': {
                level1: [
                    { q: "What does 'persevere' mean?", options: ["Give up", "Continue despite difficulty", "Start something", "Avoid challenges"], answer: 1, explanation: "Persevere means to continue trying despite difficulties." },
                    { q: "Complete: 'If I ___ rich, I would travel'", options: ["am", "was", "were", "be"], answer: 2, explanation: "Use 'were' in hypothetical conditionals." },
                    { q: "What comes next? 2, 6, 12, 20, ___", answer: "30", explanation: "Pattern: differences increase by 2 each time." },
                    { q: "Identify error: 'Neither of the students were ready'", options: ["Neither", "students", "were", "ready"], answer: 2, explanation: "'Neither' is singular, use 'was' not 'were'." },
                    { q: "What is a synonym for 'ambiguous'?", options: ["Clear", "Unclear", "Simple", "Direct"], answer: 1, explanation: "Ambiguous means unclear or open to interpretation." },
                    { q: "Rearrange: TAC", type: "anagram", answer: "CAT", explanation: "TAC rearranged spells CAT." },
                    { q: "Complete: 'She has ___ there before'", options: ["went", "gone", "go", "going"], answer: 1, explanation: "Use 'gone' with 'has' in present perfect." },
                    { q: "What does 'eloquent' mean?", options: ["Silent", "Articulate", "Confused", "Angry"], answer: 1, explanation: "Eloquent means fluent and persuasive." },
                    { q: "If LOVE = 4, what does PEACE equal?", answer: "5", explanation: "Count the letters in each word." },
                    { q: "What is an antonym for 'expand'?", options: ["Grow", "Contract", "Increase", "Enlarge"], answer: 1, explanation: "Contract means to shrink, opposite of expand." }
                ],
                level2: [
                    { q: "What does 'meticulous' mean?", options: ["Careless", "Careful", "Quick", "Lazy"], answer: 1, explanation: "Meticulous means showing great attention to detail." },
                    { q: "Complete: 'John and I ___ going'", options: ["am", "is", "are", "be"], answer: 2, explanation: "'John and I' is correct as compound subject." },
                    { q: "What pattern: Red, Blue, Green, ___", answer: "Yellow", explanation: "Color sequence pattern." },
                    { q: "Fix: 'The team are playing good'", options: ["is playing well", "are playing well", "is playing good", "are playing good"], answer: 0, explanation: "'Team' is singular; use 'well' not 'good'." },
                    { q: "What does 'pragmatic' mean?", options: ["Idealistic", "Practical", "Emotional", "Theoretical"], answer: 1, explanation: "Pragmatic means dealing with things practically." },
                    { q: "Analogy: Book : Reading :: Fork : ___", answer: "Eating", explanation: "Tools to their actions." },
                    { q: "What is a synonym for 'resilient'?", options: ["Weak", "Tough", "Fragile", "Delicate"], answer: 1, explanation: "Resilient means tough and able to recover." },
                    { q: "If all Bloops are Razzies, and all Razzies are Lazzies, are all Bloops Lazzies?", answer: "Yes", explanation: "Transitive logic." },
                    { q: "Complete: 'By tomorrow, I ___ finished'", options: ["will", "will have", "have", "had"], answer: 1, explanation: "Use future perfect tense." },
                    { q: "What does 'candid' mean?", options: ["Dishonest", "Frank", "Secretive", "Shy"], answer: 1, explanation: "Candid means frank and honest." }
                ],
                // Add levels 3-10 for age 13-20 with increasing complexity
                level3: [
                    { q: "What does 'ubiquitous' mean?", options: ["Rare", "Everywhere", "Hidden", "Ancient"], answer: 1, explanation: "Ubiquitous means present everywhere." },
                    { q: "Identify: 'Walking down the street, the trees were beautiful'", options: ["Correct", "Dangling modifier", "Missing subject", "Wrong tense"], answer: 1, explanation: "Trees can't walk - dangling modifier." },
                    { q: "Complete: 'She likes reading, writing, and ___'", options: ["to paint", "painting", "paint", "paints"], answer: 1, explanation: "Parallel structure requires same verb form." },
                    { q: "What is an antonym for 'ephemeral'?", options: ["Temporary", "Permanent", "Brief", "Short"], answer: 1, explanation: "Ephemeral means temporary, opposite is permanent." },
                    { q: "Pattern: 1, 1, 2, 3, 5, ___", answer: "8", explanation: "Fibonacci sequence." },
                    { q: "What does 'juxtapose' mean?", options: ["Separate", "Place side by side", "Remove", "Hide"], answer: 1, explanation: "Juxtapose means to place things together for comparison." },
                    { q: "Complete: 'I wish I ___ studied harder'", options: ["have", "had", "has", "having"], answer: 1, explanation: "Use past perfect in wishes about the past." },
                    { q: "What logical fallacy: 'Everyone does it, so it's right'", answer: "Bandwagon", explanation: "Bandwagon fallacy or argumentum ad populum." },
                    { q: "What does 'superfluous' mean?", options: ["Necessary", "Excessive", "Insufficient", "Perfect"], answer: 1, explanation: "Superfluous means unnecessary or excessive." },
                    { q: "Analogy: Doctor : Hospital :: Chef : ___", answer: "Kitchen", explanation: "Professionals to workplaces." }
                ]
            },
            '21-40': {
                level1: [
                    { q: "What does 'perspicacious' mean?", options: ["Confused", "Having keen insight", "Obvious", "Simple"], answer: 1, explanation: "Perspicacious means having ready insight." },
                    { q: "Fix: 'Between you and I, this is wrong'", options: ["you and me", "I and you", "myself and you", "you and myself"], answer: 0, explanation: "Use 'me' after prepositions." },
                    { q: "Pattern: 2, 6, 12, 20, ___", answer: "30", explanation: "Differences increase by 2." },
                    { q: "What does 'ineffable' mean?", options: ["Easy to express", "Too great for words", "Simple", "Common"], answer: 1, explanation: "Ineffable means too great to express in words." },
                    { q: "Identify: 'The data ___ conclusive'", options: ["is", "are", "was", "were"], answer: 0, explanation: "Data can be singular in modern English." },
                    { q: "If CIPHER = 6, what does PUZZLE equal?", answer: "6", explanation: "Count the letters." },
                    { q: "What does 'quintessential' mean?", options: ["Optional", "Perfect example", "Rare", "Outdated"], answer: 1, explanation: "Quintessential means representing the perfect example." },
                    { q: "Which shows proper subjunctive?", options: ["I wish I was rich", "I wish I were rich", "I wish I am rich", "I wish I be rich"], answer: 1, explanation: "Use 'were' for hypothetical wishes." },
                    { q: "Logic: If some philosophers are poets, and all poets are dreamers, must some philosophers be dreamers?", answer: "Yes", explanation: "Valid syllogistic reasoning." },
                    { q: "What does 'ameliorate' mean?", options: ["Worsen", "Improve", "Maintain", "Destroy"], answer: 1, explanation: "Ameliorate means to make better." }
                ]
            },
            '41-60': {
                level1: [
                    { q: "Define 'recalcitrant':", options: ["Obedient", "Defiant", "Friendly", "Calm"], answer: 1, explanation: "Recalcitrant means stubbornly defiant." },
                    { q: "Zeugma: 'She broke his car and his heart'", options: ["Correct usage", "Incorrect", "Missing comma", "Wrong tense"], answer: 0, explanation: "Correct zeugma using 'broke' for both." },
                    { q: "Which demonstrates proper semicolon use?", options: ["I went home; and ate", "I went home; I ate", "I went; home", "I; went home"], answer: 1, explanation: "Semicolons connect independent clauses." },
                    { q: "What rhetorical device: 'Ask not what your country can do for you'", answer: "Chiasmus", explanation: "Reverses structure for emphasis (antimetabole)." },
                    { q: "Conditional perfect: 'If I ___ known'", options: ["would have", "had", "have", "will have"], answer: 1, explanation: "Use 'had' in past conditional." },
                    { q: "How many letters in CONUNDRUM?", answer: "9", explanation: "C-O-N-U-N-D-R-U-M has 9 letters." },
                    { q: "Analogy: Pen : Writer :: Scalpel : ___", answer: "Surgeon", explanation: "Tools to professions." },
                    { q: "Logic: 'If A then B; B; therefore A' - Valid?", answer: "Invalid", explanation: "Fallacy of affirming the consequent." },
                    { q: "Syllogism: All mammals are animals. All dogs are mammals. Therefore all dogs are ___", answer: "animals", explanation: "Valid deductive reasoning." },
                    { q: "Fix mixed metaphor: 'We'll burn that bridge when we come to it'", options: ["cross that bridge", "burn those ships", "light that path", "walk that road"], answer: 0, explanation: "Correct idiom is 'cross that bridge'." }
                ]
            }
        };

        // Badge Definitions
        const badges = [
            { id: 'first_steps', name: 'First Steps', icon: 'ðŸŒ±', requirement: 'Complete Level 1' },
            { id: 'vocab_master', name: 'Vocab Master', icon: 'ðŸ“š', requirement: 'Answer 25 questions correctly' },
            { id: 'grammar_guru', name: 'Grammar Guru', icon: 'âœï¸', requirement: 'Complete Level 5' },
            { id: 'puzzle_solver', name: 'Puzzle Solver', icon: 'ðŸ§©', requirement: 'Solve 15 puzzles' },
            { id: 'perfectionist', name: 'Perfectionist', icon: 'â­', requirement: 'Score 100% on any level' },
            { id: 'persistent', name: 'Persistent', icon: 'ðŸ’ª', requirement: 'Complete all 10 levels' }
        ];

        // Initialize game
        function initGame() {
            createBadges();
            createLevelNavigation();
        }

        function createBadges() {
            const container = document.getElementById('badgesContainer');
            container.innerHTML = badges.map(badge => `
                <div class="badge" id="badge-${badge.id}">
                    <span class="badge-icon">${badge.icon}</span>
                    <span>${badge.name}</span>
                </div>
            `).join('');
        }

        function createLevelNavigation() {
            const nav = document.getElementById('levelNav');
            nav.innerHTML = Array.from({length: 10}, (_, i) => `
                <button class="level-btn" id="level-${i+1}" onclick="selectLevel(${i+1})" ${i > 0 ? 'disabled' : ''}>
                    Level ${i+1}
                </button>
            `).join('');
            document.getElementById('level-1').classList.add('active');
        }

        function selectAge(age) {
            gameState.ageGroup = age;
            document.getElementById('ageSelectionScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');

            startLevel(1);
            speakText(`Welcome! Let's start your learning journey. You've selected the ${age} age group.`);
        }

        function startLevel(level) {
            gameState.currentLevel = level;
            gameState.currentQuestion = 0;

            // Generate question set for this specific level
            generateQuestionSet();

            updateProgress();
            loadQuestion();
        }

        // ENHANCED: Get questions specific to the current level
        function generateQuestionSet() {
            const levelKey = `level${gameState.currentLevel}`;
            const ageData = questionBank[gameState.ageGroup];

            // Try to get level-specific questions first
            let levelQuestions = ageData[levelKey];

            // If no specific level questions, fall back to mixed questions
            if (!levelQuestions) {
                const allQuestions = [];
                for (let key in ageData) {
                    if (key.startsWith('level')) {
                        allQuestions.push(...ageData[key]);
                    }
                }
                levelQuestions = allQuestions;
            }

            // Shuffle and select 10 questions for this level
            const shuffled = [...levelQuestions].sort(() => Math.random() - 0.5);
            gameState.currentQuestionSet = shuffled.slice(0, 10);
        }

        function loadQuestion() {
            if (gameState.currentQuestion >= gameState.currentQuestionSet.length) {
                completeLevel();
                return;
            }

            const question = gameState.currentQuestionSet[gameState.currentQuestion];

            document.getElementById('questionNumber').textContent = 
                `Question ${gameState.currentQuestion + 1}/10`;

            // Determine question type
            let type = 'Vocabulary';
            if (question.q.includes('Arrange') || question.q.includes('Complete') || 
                question.q.includes('sentence') || question.q.includes('grammar') ||
                question.q.includes('Fix') || question.q.includes('Identify')) {
                type = 'Sentence Formation';
            } else if (question.type === 'pattern' || question.type === 'logic' || 
                       question.type === 'anagram' || question.q.includes('puzzle') ||
                       question.q.includes('Pattern') || question.q.includes('Analogy') ||
                       question.q.includes('Logic')) {
                type = 'Puzzle';
            }

            document.getElementById('questionType').textContent = type;
            document.getElementById('questionText').textContent = question.q;

            // Clear feedback
            document.getElementById('feedback').classList.remove('show', 'correct', 'incorrect');

            // Generate answer area based on question type
            generateAnswerArea(question);

            gameState.userAnswer = null;
        }

        function generateAnswerArea(question) {
            const area = document.getElementById('answerArea');

            if (question.options) {
                // Multiple choice
                area.innerHTML = `
                    <div class="options-grid">
                        ${question.options.map((opt, i) => `
                            <button class="option-btn" onclick="selectOption(${i})">
                                ${String.fromCharCode(65 + i)}. ${opt}
                            </button>
                        `).join('')}
                    </div>
                `;
            } else if (question.words) {
                // Arrangement puzzle
                area.innerHTML = `
                    <div class="puzzle-grid">
                        ${question.words.map((word, i) => `
                            <div class="puzzle-tile" onclick="selectTile(${i})">${word}</div>
                        `).join('')}
                    </div>
                    <input type="text" class="text-input" id="arrangementInput" 
                           placeholder="Arrange words here" readonly>
                `;
            } else {
                // Text input
                area.innerHTML = `
                    <input type="text" class="text-input" id="textAnswer" 
                           placeholder="Type your answer here">
                `;
            }
        }

        function selectOption(index) {
            document.querySelectorAll('.option-btn').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            gameState.userAnswer = index;
        }

        let selectedTiles = [];
        function selectTile(index) {
            const question = gameState.currentQuestionSet[gameState.currentQuestion];
            const tile = document.querySelectorAll('.puzzle-tile')[index];

            if (tile.classList.contains('selected')) {
                tile.classList.remove('selected');
                selectedTiles = selectedTiles.filter(i => i !== index);
            } else {
                tile.classList.add('selected');
                selectedTiles.push(index);
            }

            const answer = selectedTiles.map(i => question.words[i]).join(' ');
            document.getElementById('arrangementInput').value = answer;
            gameState.userAnswer = answer;
        }

        function submitAnswer() {
            const question = gameState.currentQuestionSet[gameState.currentQuestion];
            let correct = false;

            // Get user answer
            if (question.options) {
                correct = gameState.userAnswer === question.answer;

                // Show correct/incorrect on buttons
                document.querySelectorAll('.option-btn').forEach((btn, i) => {
                    btn.disabled = true;
                    if (i === question.answer) {
                        btn.classList.add('correct');
                    } else if (i === gameState.userAnswer) {
                        btn.classList.add('incorrect');
                    }
                });
            } else {
                const textInput = document.getElementById('textAnswer') || 
                                  document.getElementById('arrangementInput');
                gameState.userAnswer = textInput.value.trim().toLowerCase();
                const correctAnswer = question.answer ? question.answer.toLowerCase() : '';

                correct = gameState.userAnswer === correctAnswer;
            }

            // Update stats
            gameState.questionsAnswered++;
            if (correct) {
                gameState.correctAnswers++;
                gameState.totalPoints += 10 * gameState.currentLevel;
            }

            // Show feedback
            showFeedback(correct, question.explanation);
            updateProgress();
            checkBadges();

            // Auto advance after 3 seconds
            setTimeout(() => {
                nextQuestion();
            }, 3000);
        }

        function showFeedback(correct, explanation) {
            const feedback = document.getElementById('feedback');
            feedback.className = 'feedback show ' + (correct ? 'correct' : 'incorrect');

            document.getElementById('feedbackTitle').textContent = 
                correct ? 'âœ“ Correct!' : 'âœ— Incorrect';
            document.getElementById('feedbackText').textContent = explanation;

            if (correct) {
                speakText('Correct! ' + explanation);
            } else {
                speakText('Not quite. ' + explanation);
            }
        }

        function nextQuestion() {
            gameState.currentQuestion++;
            selectedTiles = [];
            loadQuestion();
        }

        function completeLevel() {
            const score = (gameState.correctAnswers / gameState.questionsAnswered) * 100;
            gameState.levelScores[gameState.currentLevel] = score;

            if (!gameState.completedLevels.includes(gameState.currentLevel)) {
                gameState.completedLevels.push(gameState.currentLevel);
            }

            // Mark level as completed
            const levelBtn = document.getElementById(`level-${gameState.currentLevel}`);
            levelBtn.classList.add('completed');

            // Unlock next level
            if (gameState.currentLevel < 10) {
                const nextBtn = document.getElementById(`level-${gameState.currentLevel + 1}`);
                nextBtn.disabled = false;

                speakText(`Congratulations! You completed level ${gameState.currentLevel} with ${Math.round(score)}%. Level ${gameState.currentLevel + 1} is now unlocked!`);

                // Auto start next level
                setTimeout(() => {
                    selectLevel(gameState.currentLevel + 1);
                }, 3000);
            } else {
                // All levels complete - show final assessment
                setTimeout(() => {
                    showFinalAssessment();
                }, 2000);
            }

            checkBadges();
        }

        function selectLevel(level) {
            if (level > 1 && !gameState.completedLevels.includes(level - 1)) {
                speakText('Please complete previous levels first!');
                return;
            }

            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`level-${level}`).classList.add('active');

            startLevel(level);
        }

        function updateProgress() {
            const progress = (gameState.completedLevels.length / 10) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressFill').textContent = Math.round(progress) + '%';

            document.getElementById('currentLevel').textContent = gameState.currentLevel;
            document.getElementById('totalPoints').textContent = gameState.totalPoints;
            document.getElementById('correctAnswers').textContent = gameState.correctAnswers;
            document.getElementById('questionsAnswered').textContent = gameState.questionsAnswered;
        }

        function checkBadges() {
            if (gameState.completedLevels.includes(1)) {
                earnBadge('first_steps');
            }
            if (gameState.correctAnswers >= 25) {
                earnBadge('vocab_master');
            }
            if (gameState.completedLevels.includes(5)) {
                earnBadge('grammar_guru');
            }
            if (gameState.completedLevels.length === 10) {
                earnBadge('persistent');
            }
            Object.values(gameState.levelScores).forEach(score => {
                if (score === 100) {
                    earnBadge('perfectionist');
                }
            });
        }

        function earnBadge(badgeId) {
            if (!gameState.earnedBadges.includes(badgeId)) {
                gameState.earnedBadges.push(badgeId);
                const badge = document.getElementById(`badge-${badgeId}`);
                badge.classList.add('earned');

                const badgeInfo = badges.find(b => b.id === badgeId);
                speakText(`Badge earned: ${badgeInfo.name}!`);
            }
        }

        function showFinalAssessment() {
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('finalScreen').classList.remove('hidden');

            document.getElementById('finalScoreDisplay').textContent = gameState.totalPoints;

            const avgScore = Object.values(gameState.levelScores).reduce((a, b) => a + b, 0) / 10;
            let message = '';

            if (avgScore >= 90) {
                message = 'ðŸ† Outstanding! You are an exceptional learner!';
            } else if (avgScore >= 75) {
                message = 'â­ Excellent work! You have strong skills!';
            } else if (avgScore >= 60) {
                message = 'ðŸ‘ Good job! Keep practicing to improve!';
            } else {
                message = 'ðŸ’ª Keep learning! Practice makes perfect!';
            }

            document.getElementById('performanceMessage').textContent = message;

            generateFinalTest();
        }

        function generateFinalTest() {
            const container = document.getElementById('finalQuestionsContainer');
            const ageData = questionBank[gameState.ageGroup];
            const allQuestions = [];

            // Collect all questions from all levels
            for (let key in ageData) {
                if (key.startsWith('level')) {
                    allQuestions.push(...ageData[key]);
                }
            }

            const finalQuestions = allQuestions
                .sort(() => Math.random() - 0.5)
                .slice(0, 10);

            container.innerHTML = finalQuestions.map((q, i) => `
                <div class="question-section" style="margin: 20px 0;">
                    <div class="question-type-badge">Question ${i + 1}</div>
                    <div class="question-text">${q.q}</div>
                    ${q.options ? `
                        <div class="options-grid">
                            ${q.options.map((opt, j) => `
                                <button class="option-btn" onclick="selectFinalOption(${i}, ${j})">
                                    ${String.fromCharCode(65 + j)}. ${opt}
                                </button>
                            `).join('')}
                        </div>
                    ` : `
                        <input type="text" class="text-input" id="final-${i}" placeholder="Your answer">
                    `}
                </div>
            `).join('');

            gameState.finalQuestions = finalQuestions;
            gameState.finalAnswers = new Array(10).fill(null);
        }

        function selectFinalOption(questionIndex, optionIndex) {
            const options = document.querySelectorAll(`.question-section:nth-child(${questionIndex + 1}) .option-btn`);
            options.forEach((btn, i) => {
                btn.classList.toggle('selected', i === optionIndex);
            });
            gameState.finalAnswers[questionIndex] = optionIndex;
        }

        function submitFinalTest() {
            let finalScore = 0;

            gameState.finalQuestions.forEach((q, i) => {
                let correct = false;

                if (q.options) {
                    correct = gameState.finalAnswers[i] === q.answer;
                } else {
                    const input = document.getElementById(`final-${i}`);
                    const userAnswer = input.value.trim().toLowerCase();
                    const correctAnswer = q.answer ? q.answer.toLowerCase() : '';
                    correct = userAnswer === correctAnswer;
                }

                if (correct) finalScore++;
            });

            alert(`Final Test Complete!\n\nYou scored ${finalScore}/10\n\nTotal Game Points: ${gameState.totalPoints}\n\nThank you for playing BrainQuest!`);

            speakText(`Final test complete. You scored ${finalScore} out of 10. Your total points are ${gameState.totalPoints}. Congratulations on completing BrainQuest!`);
        }

        // Voice Functions
        function speakQuestion() {
            const question = gameState.currentQuestionSet[gameState.currentQuestion];
            speakText(question.q);
        }

        function getHint() {
            const hints = [
                "Think carefully about the meaning of each word.",
                "Try to eliminate obviously wrong answers first.",
                "Remember what you learned in previous levels.",
                "Take your time and read the question again.",
                "Use the context clues in the question."
            ];

            const hint = hints[Math.floor(Math.random() * hints.length)];
            speakText(hint);

            alert('ðŸ’¡ Hint: ' + hint);
        }

        function speakText(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.9;
                utterance.pitch = 1;
                utterance.volume = 1;
                window.speechSynthesis.speak(utterance);
            }
        }

        function restartGame() {
            if (confirm('Are you sure you want to restart? All progress will be lost.')) {
                location.reload();
            }
        }

        // Initialize on load
        window.onload = initGame;
    </script>
</body>
</html>